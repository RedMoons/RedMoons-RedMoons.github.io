---
title: "System design"
excerpt: "가상 면접 사례로 배우는 대규모 시스템 설계 기초"

categories:
  - System design
tags:
  - System design
---
## 시간 배분
1단계 - 문제 이해 및 설계 범위 확정 : 3-10분
2단계 - 개략적 설계안 제시 및 동의 구하기 : 10-15분
3단계 - 상세 설계 : 10분에서 25분
4단계 - 마무리 : 3-5분
## 5장 안정 해시 설계
#### 해시 키 재배치 문제
캐시 서버 N개가 있다고 하자.
보편적으로 우리는 전체 데이터를 서버 N개로 나눈 나머지 값으로 파티셔닝을 합니다.
```python
serverIndex = hash(key) % N
```
그러나 이 경우, 서버를 추가하거나 삭제시 데이터 전체를 재분배해야하는 문제가 있습니다.
```python
# 3 server
server 1 : 1,4,7
server 2 : 2,5,8
server 3 : 0,3,6,9
```
이 문제를 해결하기 위해 안정해시라는 기술이 나오게 되었습니다.

#### 안정 해시
해시 테이블 크기가 조정될 떄 평균적으로 k/n개의 키만 재배치하는 해시 기술입니다.
전체 데이터 키(k)　중에 서버 수(n) 로 나눈 값만큼만 재배치됩니다.
#### 해시 공간과 해시 링
#### 해시 서버
#### 해시 키
#### 서버 조회 / 추가 / 제거
#### 기본 구현법의 두 가지 문제
    1. 서버 추가 삭제 시 파티션의 크기를 균등하게 유지할 수 없습니다.
    2. 그에 따라 키의 균등 분포를 달성하기가 어렵습니다.
#### 가상 노드
문제 해결을 위해 가상 노드를 도입합니다.
#### 재배치할 키 결정
서버 추가시의 키의 재배치
서버 제거시의 키의 재배치
#### 안정 해시 이점
    1. 서버가 추가/삭제시 재배치의 키의 수가 최소화됩니다.
    2. 데이터가 균등하게 분포되므로, 수평적 확장에 용이합니다.
   

#### 더 나아가
해시키 이상의 데이터를 저장하려면?
    Separate Chaining 을 이용해서 저장하면 됩니다.



분산환경이라면 이 안정해시 마스터 데이터의 같은 키가 만들어질 수가 있는데,
락을 이용할 시 병목구간이 될 여지가 있습니다. 
이를 위해 미리 키를 생성해 놓는 키생성기로 쓰일 키를 미리 확보해놓을 수 있습니다.

이걸 현실에서 어떻게 구현할 것인가?
해시링 마스터 데이터
가상 노드 정보를 가지고 있는 데이터가 필요하다.
[(1노드) 0,1,2,3....99,(2번노드) 100 ]
    캐시 서버라는 가정하여, 메모리기반의 중앙 집중형 레디스를 이용.

파티션이 계속 늘어나는데, 어떻게 관리할 것인가?
    결국에는 가상 노드를 재배치해야하는 순간이 온다. 언제?



## 8장 URL 단축기 설계

### 1단계 문제 이해 및 설계 범위 확정
* URL 단축기가 어떻게 동작하는지 예제 문의
* 트래픽의 규모는?
* 단축 URL의 길이는 어느 정도인지?
* 단축 URL에 포함될 문자에 제한은?
* 단축 URL을 시스템에서 지우거나 갱신가능한지?

### 개략적 추정
* 쓰기 연산 : 매일 1억개 생성
* 초당 쓰기 연산 : 1억/24/3600 = 1160
* 읽기 연산 : 읽기-쓰기 비율을 10:1이라 가정하면, 11,600회 발생
* 레코드의 수 : 10년간 운영한다면 1억x365x10=3650억　레코드
* 축약 전의 URL 평균 길이 : 100 bytes
* 10년간 필요한 저장용량 : 3650억 x 100바이트 = 36.5TB

### 개략적 설계안 제시 및 동의 구하기
#### API 엔드포인트
#### URL 리다렉션
#### URL 단축

### 3단계 상세 설계
#### 데이터 모델
#### 해시 함수
##### 해시 값 길이
##### 해시 후 충돌 해소
##### bas
