---
title: "멀티쓰레드 프로그래밍"
excerpt: "자바 스터디 10"

categories:
  - Java Study
tags:
  - java
  - 자바 스터디
---

# 목표
* 자바의 멀티쓰레드 프로그래밍에 대해 학습하세요.

### 학습할 것
* Thread 클래스와 Runnable 인터페이스
* 쓰레드의 상태
* 쓰레드의 우선순위
* Main 쓰레드
* 동기화
* 데드락


### Thread 클래스와 Runnable 인터페이스
-------------
쓰레드를 구현하는 방법은 Thread 클래스를 상속하거나 Runnable 인터페이스를 구현하는 방법이 있습니다.
Thread 클래스를 상속하게 되면 다른 클래스를 상속할 수 없게 되므로 일반적으로 Runnable 인터페이스를 구현해서 쓰레드를 구현합니다.

1. Thread 클래스를 상속
```java
class MyThread extends Thread {
  public void run() {} // Thread 클래스의 run()을 오버라이딩
}
```

2. Runnable 인터페이스를 구현
```java
class MyThread implements Runnable {
  public void run() {} // Runnable 인터페이스의 run()을 구현
}
```
Runnable 인터페이스를 구현하기 위해 run 메소드를 채워넣으면 됩니다.

##### 실제 호출 예제
```java
public class Main {
    public static void main(String[] args) {
        ThreadEx1 t1 = new ThreadEx1();

        Runnable r = new ThredEx2();
        Thread t2 = new Thread(r);

        t1.start();
        t2.start();
    }
}

class ThreadEx1 extends Thread {
    public void run() {
        for(int i=0; i<5; i++) {
            System.out.println(getName());
        }
    }
}

class ThredEx2 implements Runnable {
    public void run() {
        for(int i=0; i<5; i++) {
            System.out.println(Thread.currentThread().getName());
        }
    }
}
```

쓰레드를 실행시키려면 **start()**를 호출해야만 쓰레드가 실행됩니다.
1. start() 호출
2. 실행대기 상태로 전환
3. 실행대기 중인 쓰레드가 없으면 실행상태로 전환

> 한 가지 유의점으로, 한 번 실행이 종료된 쓰레드는 다시 실행할 수 없습니다.
> 다시 실행시키기 위해서는 새로운 쓰레드를 생성 후 **start()**을 호출해야 합니다.
> 한 쓰레드에서 **start()**를 두 번 호출시에는 *IllegalThreadStateException*이 발생합니다.

### 쓰레드의 상태
-------------
### 쓰레드의 우선순위
-------------

### Main 쓰레드
-------------
Main 쓰레드를 이해하기 위해서는 쓰레드가 어떤 식으로 동작하는지 이해해야 합니다.

1. 최초 Main 메서드에서 **start()**를 실행합니다.
2. **start()**는 쓰레드 실행에 필요한 호출 스택(call stack)을 생성합니다.
3. 호출 스택에서 **run()**을 호출하고 첫 번째로 **run()**이 올라가게 됩니다.
4. 이제 Main 쓰레드와 새로 만들어진 호출 스택, 총 2개의 호출 스택이 있으므로 스케줄러가 정한 순서에 의해 번갈아 가며 실행됩니다.

![main thread](/assets/images/mainThread.jpeg)

##### 프로그램 종료 시점
> 한 가지 유의할 점은 실행 중인 사용자 쓰레드가 하나도 없을 때 프로그램이 종료된다는 것입니다.

이 말은 Main 쓰레드가 종료되었더라도 호출 스택에 다른 쓰레드가 남아있다면 프로그램은 **아직 종료되지 않는 다**는 점입니다.

```java
public class Main {
    public static void main(String[] args) {
        Thread t3 = new Thread(new ThreadEx3());
        t3.start();
    }
}

class ThreadEx3 implements Runnable {
    @Override
    public void run() {
        throwException();
    }
    public void throwException() {
        try {
            throw new Exception();
        } catch(Exception e) {
            e.printStackTrace();
        }
    }
}

// output
java.lang.Exception
	at ThreadEx3.throwException(Main.java:33)
	at ThreadEx3.run(Main.java:29)
	at java.base/java.lang.Thread.run(Thread.java:829)
```
예제에서 보듯이
첫 번째 호출 스택이 run임을 알 수 있습니다.
우리는 Main메서드가 정상적으로 종료되었다는 사실을 알 수 있습니다.

##### start메서드와 run메서드
**start()**를 **run()**으로 바꾸어 실행해 보겠습니다.
```java
public class Main {
    public static void main(String[] args) {
        Thread t3 = new Thread(new ThreadEx3());
        t3.run();
    }
}

// output
java.lang.Exception
	at ThreadEx3.throwException(Main.java:33)
	at ThreadEx3.run(Main.java:29)
	at java.base/java.lang.Thread.run(Thread.java:829)
	at Main.main(Main.java:6)
```

**run()**을 실행시, 새로운 쓰레드가 생성되지 않았기 때문에, Main메서드를 exception에서 볼 수 있습니다.
Main 메서드의 호출 스택에서 실행되었음을 알 수 있습니다.

### 동기화
-------------
### 데드락
-------------


##### 출처
-------------
자바의 정석